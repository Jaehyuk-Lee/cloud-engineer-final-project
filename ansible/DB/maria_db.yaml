---
- hosts: DB-01
  become: yes
  vars_files:
    - /home/vagrant/main.yaml
  tasks:
    - name : mv MaiaDB.repo file
      command: mv /home/vagrant/MariaDB.repo /etc/yum.repos.d/MariaDB.repo

    - include: /home/vagrant/install.yaml
    # - name: Backup existing client.cnf file
    #   command: mv /etc/my.cnf.d/client.cnf /etc/my.cnf.d/client.bak
    #   args:
    #     creates: /etc/my.cnf.d/client.cnf.bak
    #   failed_when: false


    # - name : mv my.cnf file
    #   command: mv /home/vagrant/client.cnf /etc/my.cnf.d/client.cnf

    # - name: Backup existing mysql-clients.cnf file
    #   command: mv /etc/my.cnf.d/mysql-clients.cnf /etc/my.cnf.d/mysql-clients.bak
    #   args:
    #     creates: /etc/my.cnf.d/mysql-clients.cnf.bak
    #   failed_when: false
    # - name : mv my.cnf file
    #   command: mv /home/vagrant/mysql-clients.cnf /etc/my.cnf.d/mysql-clients.cnf

    # - name: Backup existing server.cnf file
    #   command: mv /etc/my.cnf.d/server.cnf /etc/my.cnf.d/server.bak
    #   args:
    #     creates: /etc/my.cnf.d/server.cnf.bak
    #   failed_when: false
    # - name : mv my.cnf file
    #   command: mv /home/vagrant/server.cnf /etc/my.cnf.d/server.cnf

    - name: Backup existing my.cnf file
      command: mv /etc/my.cnf /etc/my.bak
      args:
        creates: /etc/server.cnf.bak
      failed_when: false
    - name : mv my.cnf file
      command: mv /home/vagrant/my.cnf /etc/my.cnf

    - name: Restart MySQL service
      service:
        name: mariadb.service
        state: restarted

    - name: Create a new database
      mysql_db:
        login_user: myuser
        login_password: "{{ mysql_user_password }}"
        name: wbdb
        state: present

    - name: Insert data into mytable
      mysql_db:
        login_user: myuser
        login_password: "{{ mysql_user_password }}"
        name: wbdb
        state: import
        target: /home/vagrant/data.sql

