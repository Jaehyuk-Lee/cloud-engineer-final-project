name: Run vagrant up
run-name: ${{ github.actor }} is running vagrant up ðŸš€

on:
  pull_request:
    paths:
      - ansible/*
      - docker/*
      - scripts/*
      - Vagrantfile

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  vagrant-up:
    if: github.actor != 'restyled-io[bot]'
    runs-on: macos-12

    steps:
      - uses: actions/checkout@v4

      # ë²„ì¶”ì–¼ ë°•ìŠ¤ì—ì„œ 192.168.111.0/24 ëŒ€ì—­ì˜ private networkë¥¼ í—ˆìš©í•˜ê¸° ìœ„í•œ ì„¤ì •
      - name: add Network /etc/vbox/networks.conf
        run: |
          sudo mkdir -p /etc/vbox && \
          echo '* 192.168.111.0/24' > ~/networks.conf && \
          sudo mv ~/networks.conf /etc/vbox/networks.conf

      - name: Cache Vagrant boxes
        uses: actions/cache@v3
        with:
          path: ~/.vagrant.d/boxes
          key: ${{ runner.os }}-vagrant-${{ hashFiles('Vagrantfile') }}
          restore-keys: |
            ${{ runner.os }}-vagrant-

      - name: Show Vagrant version
        run: vagrant --version

      - name: Run vagrant up
        run: vagrant up

      - name: ssh into box after boot
        run: vagrant ssh ansible-server -c "echo 'hello world! ansible-server'"
